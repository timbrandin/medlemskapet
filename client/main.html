<head>
</head>

<template name="chat">
  <div class="chatrooms">
    <div class="inner">
      {{#if activeAvatar}}
      <h3>{{avatar.name}} &ndash; {{> logout}}</h3>
      {{else}}
      {{> avatars}}
      {{/if}}
    </div>
  </div>
  <div class="chatroom">
    <h3><a href="/">Samskaparna</a> &ndash; {{group.name}}</h3>
    <ul>
      {{#each rooms}}
      <li><a href="/room/{{_id}}">{{name}}</a> ({{activeAvatars}})</li>
      {{/each}}
    </ul>
    {{> roomForm}}
  </div>
</template>

<template name="logout">
  <a href="/logout">Logga ut</a>
</template>

<template name="chatrooms">
  {{#if activeAvatar}}
  <h3>{{avatar.name}} &ndash; {{> logout}}</h3>
  {{else}}
  {{> avatars}}
  <h3>Byt rum</h3>
  {{/if}}
  <ul>
    {{#each rooms}}
    <li>
      <a href="/room/{{_id}}">{{name}}</a> ({{activeAvatarsCount}})
      {{#if activeAvatars}}
      <ul>
        {{#each activeAvatars}}
        <li>{{name}}</li>
        {{/each}}
      </ul>
      {{/if}}
    </li>
    {{/each}}
  </ul>
  {{> roomForm}}
</template>

<template name="chatroom">
  <div class="chatrooms">
    <div class="inner">
      {{> chatrooms}}
    </div>
  </div>
  <div class="chatroom">
    <h3><a href="/">Samskaparna</a> &ndash; <a href="/{{group._id}}">{{group.name}}</a>: {{room.name}}</h3>
    {{#each messages}}
    <div class="message">
      <div class="inner">
        <span class="date">({{calendarDate timestamp}})</span>
        <span class="avatar">{{avatar.name}}:</span>
        <span class="box">
          {{{green message}}}
        </span>
      </div>
    </div>
    {{else}}
    ----
    {{/each}}
    {{> messageForm}}
  </div>
</template>

<template name="avatars">
  <h3>Välj karaktär</h3>
  <ul>
    {{#each avatars}}
    <li><a href="#">{{name}}</a></li>
    {{/each}}
  </ul>
  {{> avatarForm}}
</template>

<template name="avatarForm">
  Lägg till en karaktär.
  <form class="avatar-form">
    <input type="text" placeholder="namn" />
    <button type="submit">Skapa</button>
  </form>
</template>

<template name="messageForm">
  <form class="message-form">
    {{#with avatar}}
    <div>
      {{name}}
      <select>
        <option value="0">säger till</option>
        <option value="1">viskar privat till</option>
      </select>
      <select>
        <option value="0">Alla</option>
      </select>
    </div>
    <textarea></textarea>
    <button type="submit">Skicka</button>
    {{else}}
    Välj en karaktär att spela med för att delta i chatten.
    {{/with}}

  </form>
</template>

<template name="groupForm">
  {{#if currentUser}}
  Skapa ny chatt.
  <form class="group-form">
    <input type="text" placeholder="namn" />
    <button type="submit">Skapa</button>
  </form>
  {{/if}}
</template>

<template name="roomForm">
  {{#if currentUser}}
  Skapa nytt chattrum.
  <form class="room-form">
    <input type="text" placeholder="namn" tabindex="0" autofocus>
    <button type="submit" tabindex="1">Skapa</button>
  </form>
  {{/if}}
</template>

<template name="playersInRoom">
  <h3>Karaktärer i spel</h3>
  <ul>
    {{#each players}}
    <li>{{name}}</li>
    {{/each}}
  </ul>
</template>
